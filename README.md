Lab Configuration for Detection Engineering and Threat Hunting:

Inspired by:

- https://github.com/Orange-Cyberdefense/GOAD
- https://github.com/clong/detectionlab
- https://github.com/MWR-CyberSec/tabletop-lab-creation

Before you start:
- Install: Virtualbox, packer, vagrant + vagrant plugins (if you are on linux host, some winrm plugins will be required)

- Configure Virtualbox host-only network 10.10.10.0/24 

- Check packer configuration files
 	- Define which .iso files to use (local or download from web)
 		- Domain_Lab/Packer/windows-10-20h2.pkr.hcl and .../windows-2019.pkr.hcl
 			- Look for variable: "iso_url" and "iso_checksum" and apply settings that you want.
 		
- Check vagrant configuration file:
 	- Define in vagrant file path to generated by packer .box 
 		- Look for "config.vm.box" in .../Domain_Lab/Vagrantfile and configure path to .box for all hosts.

- Add planned users to .../Domain_Lab/Vagrant/provision/variables/planned-users.json
	- Make sure to use same syntax
	
- If you would like to change domain name:
	- Change Nebulatech.local to anything else in Vagrantfile
	- Change .../Domain_Lab/Vagrant/provision/variables/domain-variables.json
	- Change .../Domain_Lab/sharedscripts/networking/network-setup-rootdc.ps1

Installation:

1. packer init windows-2019.pkr.hcl
2. packer init windows-10-20h2.pkr.hcl
3. packer build windows-2019.pkr.hcl
4. packer build windows-10-20h2.pkr.hcl
5. Define path in vgarantfile for generated .box
6. vagrant build 11DC11 (Wait untill it will finish seting DC)
7. vagrant build 22W22 (Build workstation's afterwards)

Active Directory:
- Domain name: nebulatech.local

Hosts:
- Windows Server 2019 Eval (rootdc) - Domain Controller
- Windows Server 2019 Eval (server) - Server
- Windows 10 Eval (wks) - Workstation

Users:
- provision/variables/planned-users.json
- provision/variables/domain-variables.json

Network Configuration: 
- rootdc_name = "A0043LY19D" rootdc_ip = "10.10.10.100"
- server_name = "A0043LY19W1" server_ip = "10.10.10.150" 
- wks_name = "A0043LY19W2" wks_ip = "10.10.10.200"

Packer folder:
- Iso = Folder for ISO files if you are planning to provide the ISO from the local host.
	- scripts/floppy = Contains scripts that will be executed on start.
		- Provision OpenSSH, PSRemoting, PowerShell, WinRM with PowerShell.
	- scripts/provision = Contains scripts that will be executed after the initial configuration.
		- Disable Defender, updates, eject media, enable remote desktop, remove Microsoft apps, remove OneDrive, optimize (cleaning WinSxS, scheduled tasks, some telemetry), provision (configure Vagrant user, disable hibernation, set IPs, disable IPv6).
- windows-10 = Folder containing autounattend.xml for Windows 10 installation.
- windows-2019 = Folder containing autounattend.xml for Windows 2019 installation.
- Vagrantfile.template = Template file that Packer will use to create a Vagrant box.
- windows-10-20h2.pkr.hcl = Packer configuration file for Win10 box.
- windows-2019.pkr.hcl = Packer configuration file for Win2019 box.

Vagrant folder:
- file: For installation packages (EDR agents, AV, some apps, etc.).
- provision/variables: Some .json files with configurations (Domain variables, domain users, DNS entries).
- sharedscripts: Scripts that do configuration of the environment.
	- ad = Related to Domain creation, join AD, domain objects.
	- networking: Scripts that configure IPs for hosts.
	- windows: Scripts that can be used to do additional host configuration, download and install software, configure event generation, basic provisioning.
